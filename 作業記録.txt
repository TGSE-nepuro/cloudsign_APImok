# 作業記録

## 2025-11-09
- プロジェクト開始
- 開発環境の構築を開始
- Docker環境の構築完了
    - .gitignore, requirements.txt, Dockerfile, docker-compose.yml 作成
    - Dockerコンテナのビルドと起動
    - Djangoプロジェクト 'cloudsign_project' 作成
    - Djangoアプリ 'projects' 作成
    - settings.py 設定 (ALLOWED_HOSTS, INSTALLED_APPS)
    - データベースマイグレーション実行
- Projectモデル定義 (projects/models.py)
- マイグレーションファイルの生成と適用
- ProjectモデルをDjango Adminに登録 (projects/admin.py)
- ProjectモデルのCRUDビューとURLを実装 (projects/views.py, projects/urls.py)
- メインのurls.pyにprojectsアプリのURLを含める (cloudsign_project/urls.py)
- 案件管理用のHTMLテンプレートを作成 (base.html, project_list.html, project_detail.html, project_form.html, project_confirm_delete.html)
- Gitコミット: "feat: Initial Django project setup with projects app CRUD and templates"

## 2025-11-09 (更新)
- CloudSign API連携計画の更新
    - client_secretは不要であることを確認
    - クライアントID管理画面の要望に対応
    - **更新された計画:**
        1.  `CloudSignConfig` モデルの作成: `projects/models.py` に `client_id` とAPIベースURLを保存する `CloudSignConfig` モデルを作成（シングルトンとして扱う）。`makemigrations` と `migrate` を実行。
        2.  `CloudSignConfig` 管理画面の実装: `CloudSignConfig` モデルの作成・更新を行うためのビュー、URL、テンプレートを作成。`admin.py` に `CloudSignConfig` を登録。
        3.  APIクライアントモジュール (`projects/cloudsign_api.py`) の実装: `CloudSignConfig` モデルから `client_id` を取得し、アクセストークンを取得するロジックを実装。CloudSign APIの他のエンドポイントと連携する関数を実装。
        4.  `Project` ビューへのAPI統合: `Project` のCRUD操作にAPI呼び出しを統合。
- CloudSignConfigモデル定義 (projects/models.py)
- CloudSignConfigモデルのマイグレーション生成と適用
- CloudSignConfigモデルをDjango Adminに登録 (projects/admin.py)
- CloudSignConfigのCRUDビュー、URL、テンプレートを実装 (projects/views.py, projects/forms.py, projects/urls.py, cloudsignconfig_form.html)
- CloudSign APIクライアントモジュール (`projects/cloudsign_api.py`) の実装
    - `CloudSignAPIClient` クラスを定義し、シングルトンパターンを適用。
    - `CloudSignConfig` モデルから `client_id` と `api_base_url` を取得する `_load_config` メソッドを実装。
    - アクセストークンを取得する `_get_access_token` メソッドを実装（クライアントクレデンシャルフローを想定したプレースホルダー）。
    - 認証済みAPIリクエストを実行する `_make_authenticated_request` メソッドを実装（エラーハンドリングとトークンリフレッシュ機能を含む）。
    - `create_document`, `get_document_status`, `send_document` の例示APIメソッドを追加。
- `Project` ビューへのAPI統合 (`projects/views.py`)
    - `ProjectCreateView` で、プロジェクト作成時にCloudSignドキュメントを作成し、`cloudsign_document_id` を保存するように変更。
    - `ProjectUpdateView` で、`cloudsign_document_id` がない場合にCloudSignドキュメントを作成するように変更。既存ドキュメントの更新は未実装。
    - `ProjectDetailView` で、CloudSignドキュメントのステータスを取得し表示するように変更。
    - `messages` フレームワークを導入し、API連携の成功・失敗をユーザーに通知。